{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AquaFlow - Manage Announcements</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/admin/admin_manage_announcements.css' %}">

</head>
<body>

<!-- Water Animation Background -->
<div class="water-bg">
    <div class="water-wave"></div>
    <div class="water-wave"></div>
</div>

<div class="sidebar">
    <div class="logo-container">
        <div class="logo">
            <i class="fas fa-tint"></i>
        </div>
        <div class="logo-text">AquaFlow</div>
    </div>
    <ul>
        <li>
            <a href="{% url 'admin_dashboard' %}" style="text-decoration: none; color: inherit; display: flex; align-items: center;">
                <i class="fas fa-chart-bar"></i>
                <span class="menu-text">Dashboard</span>
            </a>
        </li>
        <li class="active">
            <a href="{% url 'admin_manage_announcements' %}" style="text-decoration: none; color: inherit; display: flex; align-items: center;">
                <i class="fas fa-bullhorn"></i>
                <span class="menu-text">Announcements</span>
            </a>
        </li>
        <li>
            <a href="{% url 'view_users' %}" style="text-decoration: none; color: inherit; display: flex; align-items: center;">
                <i class="fas fa-users"></i>
                <span class="menu-text">User Management</span>
            </a>
        </li>
        <li>
            <a href="{% url 'admin_manage_reports' %}" style="text-decoration: none; color: inherit; display: flex; align-items: center;">
                <i class="fas fa-file-alt"></i>
                <span class="menu-text">Manage Reports</span>
            </a>
        </li>
        <li>
            <a href="{% url 'admin_settings_view' %}" style="text-decoration: none; color: inherit; display: flex; align-items: center;">
                <i class="fas fa-cog"></i>
                <span class="menu-text">Settings</span>
            </a>
        </li>
        <li>
            <a href="{% url 'admin_profile_view' %}" style="text-decoration: none; color: inherit; display: flex; align-items: center;">
                <i class="fas fa-user"></i>
                <span class="menu-text">Profile</span>
            </a>
        </li>
    </ul>

    <div class="sidebar-footer">
        <div class="admin-avatar">
            <i class="fas fa-user-shield"></i>
        </div>
        <div class="admin-info">
            <div class="admin-name">Admin User</div>
            <div class="admin-role">System Administrator</div>
        </div>
        <button class="logout-btn" title="Logout" onclick="logout()">
            <i class="fas fa-sign-out-alt"></i>
        </button>
    </div>
</div>

<div class="main-content">
    <header>
        <h1>Manage Announcements</h1>
        <div class="header-subtitle">Create and manage system-wide announcements</div>
    </header>
    
    <div style="text-align: right; margin-bottom: 25px;">
        <button class="btn btn-accent" id="openModalBtn">
            <i class="fas fa-plus"></i> Add New Announcement
        </button>
    </div>
    
    <div class="announcements-container">
        {% if announcements %}
            {% for announcement in announcements %}
            <div class="announcement-card">
                <div class="announcement-header">
                    <div class="announcement-title">{{ announcement.title }}</div>
                    <div class="announcement-date">{{ announcement.created_at|date:"M d, Y H:i" }}</div>
                </div>
                <div class="announcement-message">{{ announcement.message }}</div>
                <div class="announcement-actions">
                    <button class="btn btn-primary" onclick="editAnnouncement({{ announcement.id }})">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <form method="POST" action="{% url 'delete_announcement_admin' announcement.id %}" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this announcement?')">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </form>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <i class="fas fa-bullhorn"></i>
                <h3>No Announcements Yet</h3>
                <p>Create your first announcement to share important information with users.</p>
                <button class="btn btn-accent" id="openModalBtnEmpty">
                    <i class="fas fa-plus"></i> Create Announcement
                </button>
            </div>
        {% endif %}
    </div>
</div>

<!-- Add/Edit Announcement Modal -->
<div id="announcementModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" id="closeModalBtn">&times;</span>
        <h3><i class="fas fa-bullhorn"></i> <span id="modalTitle">Add Announcement</span></h3>
        <form method="POST" action="{% url 'create_announcement_admin' %}" id="announcementForm">
            {% csrf_token %}
            <input type="hidden" name="announcement_id" id="announcementId">
            
            <div class="form-group">
                <label for="title">Title</label>
                <input type="text" id="title" name="title" class="form-control" placeholder="Enter announcement title" required>
            </div>
            
            <div class="form-group">
                <label for="message">Message</label>
                <textarea id="message" name="message" class="form-control" placeholder="Enter announcement message" required></textarea>
            </div>
            
            <div class="modal-actions">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Save Announcement
                </button>
                <button type="button" class="btn" style="background: #e0e0e0;" id="cancelBtn">
                    Cancel
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    // Modal functionality
    const modal = document.getElementById("announcementModal");
    const openBtn = document.getElementById("openModalBtn");
    const openBtnEmpty = document.getElementById("openModalBtnEmpty");
    const closeBtn = document.getElementById("closeModalBtn");
    const cancelBtn = document.getElementById("cancelBtn");
    const modalTitle = document.getElementById("modalTitle");
    const announcementForm = document.getElementById("announcementForm");
    const announcementId = document.getElementById("announcementId");
    const titleInput = document.getElementById("title");
    const messageInput = document.getElementById("message");

    // Open modal for new announcement
    if (openBtn) {
        openBtn.onclick = () => {
            resetForm();
            modalTitle.textContent = "Add Announcement";
            modal.style.display = "flex";
        };
    }

    if (openBtnEmpty) {
        openBtnEmpty.onclick = () => {
            resetForm();
            modalTitle.textContent = "Add Announcement";
            modal.style.display = "flex";
        };
    }

    // Close modal
    closeBtn.onclick = () => modal.style.display = "none";
    cancelBtn.onclick = () => modal.style.display = "none";
    
    // Close modal when clicking outside
    window.onclick = (e) => { 
        if (e.target === modal) modal.style.display = "none"; 
    }

    // Reset form
    function resetForm() {
        announcementId.value = "";
        titleInput.value = "";
        messageInput.value = "";
        announcementForm.action = "{% url 'create_announcement_admin' %}";
    }

    // Edit announcement
    function editAnnouncement(id) {
        // In a real implementation, you would fetch the announcement data
        // For now, we'll simulate with dummy data
        const announcement = {
            id: id,
            title: "Announcement " + id,
            message: "This is the content of announcement " + id
        };
        
        announcementId.value = announcement.id;
        titleInput.value = announcement.title;
        messageInput.value = announcement.message;
        modalTitle.textContent = "Edit Announcement";
        
        // Update form action for editing
       
        
        modal.style.display = "flex";
    }

    // Logout functionality
    function logout() {
        if (confirm('Are you sure you want to logout?')) {
            window.location.href = "{% url 'logout' %}";
        }
    }

    // Form submission handling
    announcementForm.addEventListener('submit', function(e) {
        // You can add additional validation here if needed
        // The form will submit normally if validation passes
    });
</script>

</body>
</html>